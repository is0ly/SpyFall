<html>
	<body>
		<p>
			<button>Декодировать</button>
		</p>
		<canvas id="source" width="600" height="400"></canvas>
		<canvas id="message" width="600" height="400"></canvas>
		<canvas id="solver" width="600" height="400"></canvas>

		<script src="./data.js"></script>
		<script src="./functions.js"></script>
		<script>
			const width = 600;
			const height = 400;
			const key = getEncryptionKey();
			console.log("Ключ шифрования", key);

			document.querySelector("button").addEventListener("click", () => {
				let pixelRArray = [];
				let pixelGArray = [];
				let pixelBArray = [];
				let secretPixel;
				let SecretPixelArray = [];
				for (let y = 0; y < height; y++) {
					for (let x = 0; x < width; x++) {
						// console.log("x", x);
						// console.log("y", y);
						// Получение пикселя оригинального сообщения
						const originalPixel = getOriginalPixelColor(x, y);
						// Получение пикселя зашифрованного сообщения
						const secretPixel = getMessagePixelColor(x, y);

						// pixelRArray.push(pixelr);
						// pixelGArray.push(pixelg);
						// pixelBArray.push(pixelb);

						// ABC'.charCodeAt(0)

						// console.log(pixelr);

						let binaryR = (
							secretPixel.r - originalPixel.r
						).toString(2);
						let binaryG = (
							secretPixel.g - originalPixel.g
						).toString(2);
						let binaryB = (
							secretPixel.b - originalPixel.b
						).toString(2);

						for (let i = 0; i < 3; i++) {
							if (binaryB < 3) {
								binaryB = 0 + binaryB;
							}
						}
						for (let i = 0; i < 3; i++) {
							if (binaryG < 3) {
								binaryG = 0 + binaryG;
							}
						}
						for (let i = 0; i < 3; i++) {
							if (binaryR < 2) {
								binaryR = 0 + binaryR;
							}
						}

						// console.log("BinR", binaryR);
						// console.log("BinG", binaryG);
						// console.log("BinB", binaryB);

						// console.log(SecretPixelArray);

						let digit = parseInt(binaryR + binaryG + binaryB, 2);

						SecretPixelArray.push(digit);

						//console.log(secretPixelArray);
						// let index = 0;
						// for (let i = 0; i < SecretPixelArray.length; i++) {
						// 	if (index < key.length) {
						// 		digit =
						// 			SecretPixelArray[index] ^
						// 			key.charCodeAt(index);
						// 		index++;
						// 		// console.log(digit);
						// 	} else {
						// 		index = 0;
						// 	}

						// 	// console.log(digit);
						// }

						// console.log(digit);

						originalPixel.r = digit;
						originalPixel.g = digit;
						originalPixel.b = digit;

						putPixelToSolution(originalPixel, x, y);

						//console.log(digit.length);

						// console.log(digit);
						// let digitG = parseInt(binaryG, 2);
						// let digitB = parseInt(binaryB, 2);

						// console.log(digitR);
						// console.log(digitG);
						// console.log(digitB);
					}
				}
				// console.log("R", pixelRArray);
				// console.log("G", pixelGArray);
				// console.log("B", pixelBArray);
			});
		</script>
	</body>
</html>
